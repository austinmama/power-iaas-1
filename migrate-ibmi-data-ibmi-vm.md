---

copyright:
  years: 2020, 2023

lastupdated: "2023-07-25"

keywords: IBM i, Migrate, Power VS, IBM i MDM, save data

subcollection: power-iaas

---

{:shortdesc: .shortdesc}
{:screen: .screen}
{:codeblock: .codeblock}
{:pre: .pre}
{:tip: .tip}
{:note: .note}
{:important: .important}
{:deprecated: .deprecated}
{:external: target="_blank" .external}

# Configuring Mass Data Migration (MDM) on IBM i VM
{: #configure-MDM-ibmivm}

You can migrate data of IBM i&reg; virtual machines (VMs) to the IBM Cloud object storage by using an IBM Cloud MDM device. The IBM i VM data is copied or moved to virtual optical images in a Network File System (NFS) share on the MDM device at your data center. After you save the data to virtual optical image, send the MDM device back to IBM. Your IBM i VM data is moved to the IBM Cloud Object Storage where you can access your data.

<!-- ## Setting up IBM Cloud Storage Object account
{: #setup-ibmcloud-storageobject}

You can set up your IBM Cloud Object Storage account for data migration and request a pre-configured storage device that can be used to move your data to IBM Cloud Object Storage. For more information, see [Getting started tutorial](/docs/mass-data-migration?topic=mass-data-migration-getting-started-tutorial) on MDM and [Mass Data Migration overview](/docs/mass-data-migration?topic=mass-data-migration-overview).

## Configuring MDM device on IBM i VM
{: #configure-MDMdevice-ibmiVM}

After you receive the pre-configured storage device, use the following checklist to complete the MDM device setup.

1. [Connect the MDM device to your IBM i VM](/docs/mass-data-migration?topic=mass-data-migration-connect-device).

2. [Update the network settings of the MDM device to connect it to your local network](/docs/mass-data-migration?topic=mass-data-migration-ip-settings).

3. [Log in to the MDM device user interface](/docs/mass-data-migration?topic=mass-data-migration-access-ui).

4. [Unlock the storage pool of the MDM device](/docs/mass-data-migration?topic=mass-data-migration-unlock-storage-pool).

5. [Ensure the NFS shares are set up correctly for the IBM i VM](/docs/mass-data-migration?topic=mass-data-migration-connect-nfs-share). The NFS directory (or a parent directory) that contains the virtual optical images must be shared with the following characteristics:

   * Share with the following IP addresses:
     * IP address of the IBM i client VM.
     * You must connect to the IP address of the service tools server. For instructions on setting up service tools server, see [Configuring the service tools server for DST](https://www.ibm.com/support/knowledgecenter/ssw_ibm_i_74/rzamh/rzamhsrvtoolsrvr4dst.html).
     * You must connect to the network share of the MDM device with both read and writer access. -->

## Preparing IBM i VM to use the MDM device
{: #prepate-ibmiVM}

To share virtual optical images with an IBM i VM by using an NFS server, the following requirements must be met.

* The IBM i NFS VM must have IPv4 address.
* The IBM i NFS VM must have the NFS server share that is mounted over a local directory during the setup process.
* The IBM i NFS VM must have a 632B-003 virtual optical device that uses the IP address of the NFS server.
* A directory under the NFS server share must contain images that have sufficient size to hold all the saved data for the IBM i VM. The **Save** operations cannot dynamically create new images or extend the size of existing images, so understanding the size of the data that is generated by the save operation is important.
* A directory under the NFS server share must have a volume list file that contains a list of images to be used by an IBM i VM. The volume list file must have the following characteristics:
    * The file must be in the same directory as the image files.
    * The file must be named VOLUME_LIST.
    * Each entry in the file is either an image file name with access information or a comment.
    * Image file names are limited to 127 characters.
    * All characters following a hash symbol (#) are considered a comment and are ignored.
    * The order of the image file names in the volume list file indicates the order of the images that are processed on the IBM i VM.
    * The file must contain ASCII characters.

## Setting up IBM i VM to use images on an NFS server
{: #setup-ibmivm-to-use-nfs-server}

You can set up the IBM i VM to use virtual optical images that are stored on an NFS server. The following example assumes that the NFS server (*SERVER01*) with IP address *'1.2.3.4'* has share */nfs/share01*. Complete the following steps to set up the IBM i VM to use the images on NFS server:

1. Create a mount directory for the NFS server.

    ```text
    MKDIR DIR('/NFS')
    MKDIR DIR('/NFS/SERVER01')
    ```

2. Mount the NFS server root directory over the mount directory of the IBM i VM.

    ```text
    MOUNT TYPE(*NFS) MFS('1.2.3.4:/nfs/share01') MNTOVRDIR('/NFS/SERVER01')
    ```
    {: codeblock}

3. Create image information on the NFS server in the Portable Application Solutions Environment (PASE):

   i. Enter PASE.

    ```text
    CALL PGM(QP2TERM)
    ```

   ii. Create a directory to contain the virtual image files.

    ```text
    mkdir /NFS/SERVER01/iImages
    ```

   iii. Change the directory to the virtual image file directory.

    ```text
    cd /NFS/SERVER01/iImages
    ```

   iv. Create image files. The number of images and the size of the images cannot be changed during a *save* operation. So the image files must be created with sufficient size to hold all the saved data. Following example creates 3 images of 10 GB size each.

   Creating large files can take several minutes. Do not exit PASE until each of the commands have sent a completion message.
   {: note}

    ```text
    dd if=/dev/zero of=IMAGE01.ISO bs=1M count=10000
    dd if=/dev/zero of=IMAGE02.ISO bs=1M count=10000
    dd if=/dev/zero of=IMAGE03.ISO bs=1M count=10000
    ```

   v. Create volume list file.

    ```text
    rm VOLUME_LIST
    echo 'IMAGE01.ISO W' >> VOLUME_LIST
    echo 'IMAGE02.ISO W' >> VOLUME_LIST
    echo 'IMAGE03.ISO W' >> VOLUME_LIST
    ```

   The **W** at the end of each line indicates that image allows write access. You can verify the list by using following command.

      ```text
      cat VOLUME_LIST
      ```

   vi. The output of this command displays a line for each of the image file names with the corresponding access information.

    ```text
    IMAGE01.ISO W
    IMAGE02.ISO W
    IMAGE03.ISO W
    ```
   {: screen}

   vii. Press F3 to exit the PASE.

4. Create a device description for a virtual optical device.

    ```text
    CRTDEVOPT DEVD(NFSDEV01) RSRCNAME(*VRT) LCLINTNETA(*SRVLAN)
    RMTINTNETA('1.2.3.4') NETIMGDIR('/nfs/share01/iImages')
    ```

5. Vary on the virtual optical device.

   If the image files or VOLUME_LIST file is changed on the NFS server, the virtual optical device must be varied off and then varied back on to use the virtual images.
   {: note}

    ```text
    VRYCFG CFGOBJ(NFSDEV01) CFGTYPE(*DEV) STATUS(*ON)
    ```

6. Use the device to initialize the image files as optical volumes.

    ```text
    LODIMGCLGE IMGCLG(*DEV) IMGCLGIDX(3) DEV(NFSDEV01)
    INZOPT NEWVOL(IVOL03) DEV(NFSDEV01) CHECK(*NO)
    LODIMGCLGE IMGCLG(*DEV) IMGCLGIDX(2) DEV(NFSDEV01)
    INZOPT NEWVOL(IVOL02) DEV(NFSDEV01) CHECK(*NO)`
    LODIMGCLGE IMGCLG(*DEV) IMGCLGIDX(1) DEV(NFSDEV01) 
    INZOPT NEWVOL(IVOL01) DEV(NFSDEV01) CHECK(*NO)
    ```

7. You can now use the **NFSDEV01** virtual device for native IBM i *save* and *restore* operations. Volume *IVOL01* `(image file '/nfs/share01/iImages/IMAGE01.ISO')` is mounted on device **NFSDEV01**.

   * To test the virtual device, verify that a message queue can be saved and restored. Messages from the save and restore commands must indicate that one object was saved and one object was restored.

      ```text
      CRTMSGQ MSGQ(QTEMP/MSGQ)
      SAVOBJ OBJ(MSGQ) LIB(QTEMP) DEV(NFSDEV01) CLEAR(*ALL)
      RSTOBJ OBJ(*ALL) SAVLIB(QTEMP) DEV(NFSDEV01)
      ```

   * The saved contents of the virtual optical volume can also be displayed by using the following command:

      ```text
      DSPOPT VOL(IVOL01) DEV(NFSDEV01) DATA(*SAVRST) PATH(*ALL)
      ```

## Saving IBM i VM data to the MDM device
{: #save-ibmidata-to-MDMdevice}

Save the data from the IBM i VM to the 632 B optical device by using normal save mechanisms. If you plan to restore from a network installation server, you can use a *SAVSYS* command. If you want to restore from a local *IMGCLG*, then you must create a distribution media by using **option 40** on the **GO LICPGM** menu.

## Returning the MDM device to IBM
{: #return-MDMdevice-toIBM}

Follow the [Returning the device](/docs/mass-data-migration?topic=mass-data-migration-return-device) process to complete the migration of IBM i VM data to your IBM Cloud Object Storage account.
